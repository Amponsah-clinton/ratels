{% extends "member/base_member.html" %}
{% load static %}

{% block title %}My Subscriptions{% endblock %}

{% block extra_css %}
<style>
    .subs-page-header {
        margin-bottom: 1.5rem;
    }
    .subs-page-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #1e293b;
        margin: 0;
    }
    .subs-page-subtitle {
        color: #64748b;
        font-size: 0.95rem;
        margin: 0.25rem 0 0 0;
    }

    .subs-list-card {
        background: #fff;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        overflow: hidden;
        margin-bottom: 1.5rem;
    }
    .subs-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9rem;
    }
    .subs-table th {
        text-align: left;
        padding: 1rem 1.25rem;
        background: #f8fafc;
        color: #475569;
        font-weight: 600;
        border-bottom: 1px solid #e2e8f0;
    }
    .subs-table td {
        padding: 1rem 1.25rem;
        border-bottom: 1px solid #f1f5f9;
        color: #334155;
    }
    .subs-table tbody tr:last-child td {
        border-bottom: none;
    }
    .subs-table tbody tr:hover td {
        background: #fafafa;
    }
    .subs-status {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 500;
    }
    .subs-status.active {
        background: #dcfce7;
        color: #166534;
    }
    .subs-status.expired {
        background: #fee2e2;
        color: #991b1b;
    }
    .subs-empty {
        text-align: center;
        padding: 3rem 2rem;
        color: #64748b;
        background: #f8fafc;
        border-radius: 12px;
        border: 1px dashed #e2e8f0;
    }
    .subs-empty p {
        margin: 0 0 0.5rem 0;
        font-size: 1rem;
    }
    .subs-empty a {
        color: #0f172a;
        font-weight: 500;
        text-decoration: none;
    }
    .subs-empty a:hover {
        text-decoration: underline;
    }

    .subs-btn-pdf {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.4rem 0.75rem;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 500;
        text-decoration: none;
        border: 1px solid #e2e8f0;
        background: #fff;
        color: #334155;
        transition: background 0.2s, border-color 0.2s;
    }
    .subs-btn-pdf:hover {
        background: #0f172a;
        border-color: #0f172a;
        color: #fff;
    }
</style>
{% endblock %}

{% block content %}
<div class="subs-page-header">
    <h1 class="subs-page-title">My Subscriptions</h1>
    <p class="subs-page-subtitle">View your membership subscription history and download invoices</p>
</div>

{% if subscriptions %}
<div class="subs-list-card">
    <table class="subs-table">
        <thead>
            <tr>
                <th>Period</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Payment ref</th>
                <th>Method</th>
                <th>Invoice</th>
            </tr>
        </thead>
        <tbody>
            {% for s in subscriptions %}
            <tr>
                <td>{{ s.start_date }} – {{ s.end_date }}</td>
                <td>{{ s.amount_paid }} ({{ s.months_subscribed }} month{{ s.months_subscribed|pluralize }})</td>
                <td><span class="subs-status {{ s.status }}">{{ s.status }}</span></td>
                <td><code style="font-size:0.85em;">{{ s.payment_reference|default:"—" }}</code></td>
                <td>{{ s.payment_method|default:"—" }}</td>
                <td>
                    <a href="{% url 'member_subscription_invoice_pdf' subscription_id=s.id %}" class="subs-btn-pdf" download="invoice-{{ s.payment_reference|default:s.id }}.pdf">
                        <i data-lucide="file-down" style="width:16px;height:16px;"></i>
                        Download PDF
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="subs-empty">
    <p>You don't have any subscription records yet.</p>
    <p><a href="{% url 'member_renew' %}">Activate or renew your membership</a></p>
</div>
{% endif %}
{% endblock %}

{% block extra_scripts %}
<script>
(function() {
    if (typeof lucide !== 'undefined') lucide.createIcons();
})();
</script>
{% endblock %}
